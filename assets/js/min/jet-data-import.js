!function(e,t){"use strict";(t={selectors:{trigger:"#jet-import-start",advancedTrigger:'button[data-action="start-install"]',popupTrigger:'button[data-action="confirm-install"]',removeContent:'button[data-action="remove-content"]',upload:"#jet-file-upload",globalProgress:"#jet-import-progress"},globalProgress:null,init:function(){e(function(){t.globalProgress=e(t.selectors.globalProgress).find(".cdi-progress__bar"),e("body").on("click.cdiImport",t.selectors.trigger,t.goToImport).on("click.cdiImport",t.selectors.advancedTrigger,t.advancedImport).on("click.cdiImport",t.selectors.popupTrigger,t.confirmImport).on("click.cdiImport",t.selectors.removeContent,t.removeContent).on("focus.cdiImport",".cdi-remove-form__input",t.clearRemoveNotices).on("change.cdiImport",'input[name="install-type"]',t.advancedNotice).on("click.cdiImport",".cdi-advanced-popup__close",t.closePopup),e(document).on("tm-wizard-install-finished",t.wizardPopup).on("cdiSliderInit",t.initSlider),window.JetDataImportVars.autorun&&t.startImport(),void 0!==window.JetRegenerateData&&t.regenerateThumbnails(),t.fileUpload(),t.initSlider()})},initSlider:function(){var t=e(".cdi-slider .swiper-container");t.length&&new Swiper(t[0],{paginationClickable:!0,autoplay:15e3,pagination:".slider-pagination",parallax:!0,speed:600})},wizardPopup:function(){e(".cdi-advanced-popup").removeClass("popup-hidden").trigger("cdi-popup-opened")},removeContent:function(){var a=e(this),o=a.prev(),r=a.closest(".cdi-remove-form"),i=e(".cdi-remove-form__notices",r),s={};a.hasClass("in-progress")||(s.action="jet-data-import-remove-content",s.nonce=window.JetDataImportVars.nonce,s.password=o.val(),a.addClass("in-progress"),e.ajax({url:window.ajaxurl,type:"post",dataType:"json",data:s,error:function(){a.removeClass("in-progress")}}).done(function(e){!0===e.success?(r.addClass("content-removed"),i.removeClass("cdi-hide"),i.html(e.data.message).removeClass("cdi-error"),void 0!==e.data.slider&&t.showSlider(r,e.data.slider),t.startImport()):(i.addClass("cdi-error").removeClass("cdi-hide"),i.html(e.data.message)),a.removeClass("in-progress")}))},showSlider:function(t,a){setTimeout(function(){t.before(a),t.remove(),console.log(""),e(document).trigger("cdiSliderInit")},2e3)},clearRemoveNotices:function(){var t=e(this).closest(".cdi-remove-form");e(".cdi-remove-form__notices",t).removeClass("cdi-error").addClass("cdi-hide")},closePopup:function(){e(".cdi-advanced-popup").addClass("popup-hidden").data("url",null),e(".cdi-btn.in-progress").removeClass("in-progress")},confirmImport:function(){var t=e(this),a=t.closest(".cdi-advanced-popup"),o=e('.cdi-advanced-popup__item input[type="radio"]:checked',a),r="append",i=a.data("url");t.addClass("in-progress"),void 0!==o.val()&&""!==o.val()&&(r=o.val()),i=i+"&type="+r,window.location=i},advancedImport:function(){var t=e(this),a=t.closest(".advanced-item"),o=e('.advanced-item__type-checkbox input[type="checkbox"]',a),r=window.JetDataImportVars.advURLMask,i=a.data("full"),s=a.data("lite");t.addClass("in-progress"),r=o.is(":checked")?r.replace("<-file->",s):r.replace("<-file->",i),e(".cdi-advanced-popup").removeClass("popup-hidden").data("url",r)},advancedNotice:function(){var t=e(this),a=t.closest(".cdi-advanced-popup__content"),o=e(".cdi-advanced-popup__warning",a);t.is(":checked")&&"replace"===t.val()?o.removeClass("cdi-hide"):o.hasClass("cdi-hide")||o.addClass("cdi-hide")},regenerateThumbnails:function(){var e={action:"jet-data-thumbnails",offset:0,step:window.JetRegenerateData.step,total:window.JetRegenerateData.totalSteps};t.ajaxRequest(e)},ajaxRequest:function(a){var o;a.nonce=window.JetDataImportVars.nonce,a.file=window.JetDataImportVars.file,e.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:a,error:function(){a.step?(o=Math.ceil(100*(a.offset+a.step)/(a.total*a.step)),t.globalProgress.css("width",o+"%").find(".cdi-progress__label").text(o+"%"),a.offset=a.offset+a.step,t.ajaxRequest(a)):e("#jet-import-progress").replaceWith('<div class="import-failed">'+window.JetDataImportVars.error+"</div>")}}).done(function(a){!0!==a.success||a.data.isLast||t.ajaxRequest(a.data),a.data&&a.data.redirect&&(window.location=a.data.redirect),a.data&&a.data.complete&&(t.globalProgress.css("width",a.data.complete+"%").find(".cdi-progress__label").text(a.data.complete+"%").closest(".cdi-progress__bar").next(".cdi-progress__sub-label").text(a.data.complete+"%"),t.globalProgress.siblings(".cdi-progress__placeholder").remove()),a.data&&a.data.processed&&e.each(a.data.processed,t.updateSummary)})},updateSummary:function(t,a){var o=e('tr[data-item="'+t+'"]'),r=parseInt(o.data("total"),10),i=e(".cdi-install-summary__done",o),s=e(".cdi-install-summary__percent",o),n=e(".cdi-progress__bar",o),d=e(".cdi-progress-status",o),l=Math.round(parseInt(a,10)/r*100);i.hasClass("is-finished")||(100===l&&(i.addClass("is-finished").closest("td").addClass("is-finished"),d.html('<span class="dashicons dashicons-yes"></span>')),i.html(a),s.html(l),n.css("width",l+"%"))},startImport:function(){t.ajaxRequest({action:"jet-data-import-chunk",chunk:1})},prepareImportArgs:function(){var t=null,a=e('input[name="upload_file"]'),o=e('select[name="import_file"]');return a.length&&""!==a.val()&&(t=a.val()),o.length&&null===t&&(t=e("option:selected",o).val()),"&tab="+window.JetDataImportVars.tab+"&step=2&file="+t},goToImport:function(){var a=e('input[name="referrer"]').val();e(this).hasClass("disabled")||(window.location=a+t.prepareImportArgs())},fileUpload:function(){var a=e(t.selectors.upload),o=a.closest(".import-file"),r=o.find(".import-file__placeholder"),i=o.find(".import-file__input"),s=wp.media.frames.file_frame=wp.media({title:window.JetDataImportVars.uploadTitle,button:{text:window.JetDataImportVars.uploadBtn},multiple:!1});a.on("click",function(){return s.open(),!1}),s.on("select",function(){var e=s.state().get("selection").toJSON()[0];r.val(e.url),t.getFilePath(e.url,i)})},getFilePath:function(a,o){var r=e(t.selectors.trigger);r.addClass("disabled"),e.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:{action:"jet-data-import-get-file-path",file:a,nonce:window.JetDataImportVars.nonce},error:function(){return r.removeClass("disabled"),!1}}).done(function(e){r.removeClass("disabled"),!0===e.success&&o.val(e.data.path)})}}).init()}(jQuery,window.JetDataImport);